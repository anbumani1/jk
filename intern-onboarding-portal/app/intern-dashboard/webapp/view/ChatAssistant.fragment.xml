<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f">
    
    <Dialog id="chatDialog" title="AI Assistant" contentWidth="600px" contentHeight="500px" resizable="true">
        <content>
            <VBox class="sapUiMediumMargin">
                
                <!-- Suggested Questions -->
                <Panel headerText="Suggested Questions" expandable="true" expanded="true" class="sapUiMediumMarginBottom">
                    <content>
                        <FlexBox wrap="Wrap" class="sapUiTinyMargin">
                            <Button 
                                text="{chatModel>question}" 
                                press="onSuggestionPress" 
                                type="Transparent" 
                                class="sapUiTinyMargin"
                                items="{chatModel>/suggestions}" />
                        </FlexBox>
                    </content>
                </Panel>
                
                <!-- Chat Messages -->
                <ScrollContainer height="300px" vertical="true" class="sapUiMediumMarginBottom">
                    <VBox items="{chatModel>/messages}">
                        <HBox class="sapUiTinyMarginBottom" justifyContent="{path: 'chatModel>sender', formatter: '.formatMessageAlignment'}">
                            <VBox class="sapUiTinyMargin">
                                <f:Card width="auto" class="{path: 'chatModel>sender', formatter: '.formatMessageStyle'}">
                                    <f:content>
                                        <VBox class="sapUiSmallMargin">
                                            <Text text="{chatModel>text}" wrapping="true" />
                                            <HBox justifyContent="SpaceBetween" class="sapUiTinyMarginTop">
                                                <Text text="{chatModel>timestamp}" class="sapUiTinyText" />
                                                <Text 
                                                    text="Confidence: {chatModel>confidence}" 
                                                    class="sapUiTinyText"
                                                    visible="{path: 'chatModel>sender', formatter: '.formatConfidenceVisible'}" />
                                            </HBox>
                                        </VBox>
                                    </f:content>
                                </f:Card>
                            </VBox>
                        </HBox>
                    </VBox>
                </ScrollContainer>
                
                <!-- Loading Indicator -->
                <BusyIndicator visible="{chatModel>/isLoading}" class="sapUiMediumMarginBottom" />
                
                <!-- Message Input -->
                <HBox>
                    <Input 
                        value="{chatModel>/currentMessage}" 
                        placeholder="Ask me anything about your onboarding..."
                        submit="onSendMessage"
                        class="sapUiMediumMarginEnd"
                        width="100%" />
                    <Button text="Send" press="onSendMessage" type="Emphasized" />
                </HBox>
                
            </VBox>
        </content>
        <buttons>
            <Button text="Close" press="onCloseChatAssistant" />
        </buttons>
    </Dialog>
    
</core:FragmentDefinition>
